
{
  "entities": {
    "Restaurant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Restaurant",
      "type": "object",
      "description": "Represents a restaurant and its loyalty program configuration.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Restaurant entity (matches Firebase Auth UID)." },
        "name": { "type": "string", "description": "The name of the restaurant." },
        "email": { "type": "string", "description": "The contact email for the restaurant, used for login.", "format": "email" },
        "loyaltyReward": { "type": "string", "description": "The reward for completing a loyalty card." },
        "stampsRequiredForReward": { "type": "number", "description": "Number of stamps needed to get the loyalty reward." },
        "referralReward": { "type": "string", "description": "The reward offered to a referrer when their code is used." },
        "googleLink": { "type": "string", "description": "The Google Maps link for the restaurant's location for leaving reviews.", "format": "uri" },
        "stampsGiven": { "type": "number", "description": "The total number of stamps given out by the restaurant." },
        "rewardsGiven": { "type": "number", "description": "The total number of loyalty rewards given out." },
        "referralsCount": { "type": "number", "description": "The number of successful referrals attributed to this restaurant." },
        "qrCodeValue": { "type": ["string", "null"], "description": "The current value of the active QR code for giving stamps." },
        "qrCodeExpiry": { "type": ["number", "null"], "description": "The timestamp when the current QR code expires." },
        "cardImageUrl": { "type": "string", "description": "URL for the loyalty card's background image.", "format": "uri" }
      },
      "required": ["id", "name", "email", "loyaltyReward", "stampsRequiredForReward", "referralReward"]
    },
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a customer and their loyalty card information.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Client entity (matches Firebase Auth UID)." },
        "name": { "type": "string", "description": "The name of the client." },
        "phone": { "type": "string", "description": "The client's phone number." },
        "cards": {
          "type": "object",
          "description": "A map of loyalty cards the client has, keyed by restaurant ID.",
          "additionalProperties": { "$ref": "#/entities/ClientCard" }
        },
        "pendingReferralRewards": {
          "type": "array",
          "description": "A list of referral rewards the client has earned but not yet claimed.",
          "items": { "$ref": "#/entities/PendingReferralReward" }
        }
      },
      "required": ["id", "name", "phone", "cards"]
    },
    "ClientCard": {
      "title": "ClientCard",
      "type": "object",
      "description": "Represents a single loyalty card for a client at a specific restaurant.",
      "properties": {
        "stamps": { "type": "number", "description": "Number of stamps collected." },
        "referralCode": { "type": "string", "description": "The unique referral code for this client at this restaurant." },
        "scannedCodes": { "type": "array", "items": { "type": "string" }, "description": "List of QR code values already scanned to prevent reuse." },
        "referrerInfo": {
          "type": ["object", "null"],
          "description": "Information about the client who referred this one for this specific card.",
          "properties": {
            "code": { "type": "string", "description": "The referral code that was used." },
            "reward": { "type": "string", "description": "The reward promised for this referral." },
            "isActivated": { "type": "boolean", "description": "Whether the referral has been activated (e.g., on first stamp)." },
            "referrerId": { "type": "string", "description": "The ID of the client who referred this one." },
            "referrerName": { "type": "string", "description": "The name of the client who referred this one." }
          },
          "required": ["code", "reward", "isActivated", "referrerId", "referrerName"]
        }
      },
      "required": ["stamps", "referralCode"]
    },
    "PendingReferralReward": {
        "title": "PendingReferralReward",
        "type": "object",
        "description": "Represents a referral reward that a client has earned.",
        "properties": {
            "id": { "type": "string", "description": "Unique ID for the pending reward." },
            "restoId": { "type": "string", "description": "The ID of the restaurant where the reward can be claimed." },
            "reward": { "type": "string", "description": "The description of the reward." },
            "referredClientName": { "type": "string", "description": "Name of the client who used the referral code." }
        },
        "required": ["id", "restoId", "reward", "referredClientName"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/restaurants/{restaurantId}",
        "definition": {
          "entityName": "Restaurant",
          "schema": { "$ref": "#/entities/Restaurant" },
          "description": "Stores restaurant profiles and loyalty program configurations.",
          "params": [
            { "name": "restaurantId", "description": "Unique identifier for the restaurant, matches Auth UID." }
          ]
        }
      },
      {
        "path": "/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": { "$ref": "#/entities/Client" },
          "description": "Stores client profiles and loyalty card information.",
          "params": [
            { "name": "clientId", "description": "Unique identifier for the client, matches Auth UID." }
          ]
        }
      }
    ]
  }
}
